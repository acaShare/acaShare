@*@attribute [Microsoft.AspNetCore.Components.RouteAttribute(RouteConstants.ModeratorPanelRoute + "/MaterialsToApprove")]*@
@page "/Moderator/ModeratorPanel/MaterialsToApprove"
@attribute [Authorize(Roles = Roles.AdministratorRole + ", " + Roles.MainModeratorRole + ", " + Roles.ModeratorRole)]
@inject IMaterialsService MaterialsService
@inject IMaterialStateChangeService MaterialStateChangeService

    <AcaCollection Items="_materials" TItem="BLL.Models.Material">
        <ListItemTemplate>
            <MaterialToApproveListItem Material="context"
                                       OnApproveMaterialClickCallback="MaterialStateChangeService.OnApproveMaterialClickCallback"
                                       OnRejectMaterialClickCallback="MaterialStateChangeService.OnRejectMaterialClickCallback" />
        </ListItemTemplate>
    </AcaCollection>

@code {
    private IReadOnlyCollection<BLL.Models.Material> _materials;

    protected override void OnInitialized()
    {
        ChangePageTitle("Materiały oczekujące na zatwierdzenie");
        RefreshData();
        MaterialStateChangeService.OnEndProcessing += RefreshData;
    }

    private void RefreshData()
    {
        _materials = MaterialsService.GetMaterialsToApprove() as IReadOnlyCollection<BLL.Models.Material>;
    }

    [CascadingParameter]
    public Action<string> ChangePageTitle { get; set; }
}