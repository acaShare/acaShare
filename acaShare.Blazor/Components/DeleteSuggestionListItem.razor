@inject IJSRuntime JsRuntime

@{
    var smaller = string.Empty;
    var deleteReasonIcon = string.Empty;

    switch (Suggestion.ReasonId)
    {
        case 1:
            deleteReasonIcon = "warning";
            break;
        case 2:
            smaller = "smaller";
            deleteReasonIcon = "pan_tool";
            break;
        case 3:
            deleteReasonIcon = "receipt"; // thumb_down thumbs_up_down
            break;
        case 4:
            deleteReasonIcon = "location_off";
            break;
        case 5:
            deleteReasonIcon = "feedback";
            break;
    }
}

<i class="material-icons list-icon change-request-type-icon tooltipped @smaller" data-position="top" data-tooltip="@Suggestion.Reason">
    @deleteReasonIcon
</i>
<NavLink class="item-link" href=@($"/Moderator/ModeratorPanel/DeleteSuggestions/DeleteRequestApprovalDecision/{Suggestion.DeleteRequestId}")>
    <span class="path-list-item-title">@Suggestion.MaterialName</span>
    <br>
    <span class="path-list-item-subtitle">
        @Suggestion.RequestDate.ToString("d.MM.yyyy, HH:mm") &nbsp;&nbsp;~&nbsp;&nbsp;

        @if (Suggestion.AdditionalComment?.Length > maxCommentLength)
        {
            @Suggestion.AdditionalComment.Substring(0, maxCommentLength);
            @:[...]
        }
        else if (Suggestion.AdditionalComment?.Length > 0)
        {
            @Suggestion.AdditionalComment;
        }
        else
        {
            @:Autor: @Suggestion.DeleterName nie dołączył dodatkowego wyjaśnienia.
        }
    </span>
</NavLink>

<div class="icons-row-container">
    <a class="approve-delete-request" @onclick="() => OnApproveSuggestionClickCallback.InvokeAsync(new CallbackArgs(Suggestion.DeleteRequestId))">
        <i class="material-icons list-icon icon-edit tooltipped" data-position="top" data-tooltip="Zatwierdź - usuń materiał">delete_forever</i>
    </a>
    <a @onclick="ToggleModal">
        <i class="material-icons list-icon icon-delete tooltipped" data-position="top" data-tooltip="Odrzuć sugestię">not_interested</i>
    </a>
</div>

<!-- Modal -->
<div id="reject-confirmation" class="modal confirmation-modal @_openModalClass">
    <EditForm Model="Suggestion" OnValidSubmit="OnRejectClicked">
        <DataAnnotationsValidator />
    
        <div class="modal-content" style="display:block;">
            <div class="row">
                <div class="col s12">
                    <div>
                        <label for="Suggestion.DeclineReason">Powód odrzucenia sugestii</label>
                        <div class="input-field">
                            <InputText @bind-Value="Suggestion.DeclineReason" class="validate" />
                            <ValidationMessage For="@(() => Suggestion.DeclineReason)" />
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button type="submit" class="modal-button waves-effect waves-green btn-flat">Odrzuć sugestię usunięcia</button>
            <a class="modal-button waves-effect waves-green btn-flat" @onclick="ToggleModal">Anuluj</a>
        </div>
    </EditForm>
</div>

<div class="modal-overlay @_openModalClass"></div>

@code {
    [Parameter]
    public DeleteRequestViewModel Suggestion { get; set; }

    private const int maxCommentLength = 100;
    private string _openModalClass = string.Empty;

    private void OnRejectClicked()
    {
        OnRejectSuggestionClickCallback.InvokeAsync(new RejectSuggestionCallbackArgs(Suggestion.DeleteRequestId, Suggestion.DeclineReason));
    }

    private void ToggleModal()
    {
        if (string.IsNullOrWhiteSpace(_openModalClass))
        {
            _openModalClass = "modal-open";
        }
        else
        {
            _openModalClass = string.Empty;
            Suggestion.DeclineReason = string.Empty;
        }
    }

    //Callbacks
    [Parameter]
    public EventCallback<CallbackArgs> OnApproveSuggestionClickCallback { get; set; }

    [Parameter]
    public EventCallback<RejectSuggestionCallbackArgs> OnRejectSuggestionClickCallback { get; set; }

    [CascadingParameter]
    public Action<string> ChangePageTitle { get; set; }
}